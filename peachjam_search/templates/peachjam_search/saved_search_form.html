{% load i18n %}
<div id="saved-search-button">
  <button class="btn btn-link"
          id="saved-search-modal-button"
          data-bs-toggle="modal"
          {% if not saved_search.pk %} hx-post="{% url 'search:saved_search_create' %}" hx-include="#saved-search-form" {% endif %}
          data-bs-target="#savedSearchModal">
    <i class="bi bi-search-heart"></i>
    {% if saved_search.pk %}
      {% trans 'Update this search alert' %}
    {% else %}
      {% trans 'Get alerts for this search' %}
    {% endif %}
  </button>
</div>
<div hx-swap-oob="true" id="savedSearchModalDialog" class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">
      <h1 id="savedSearchModalLabel" class="modal-title fs-5">Search alert</h1>
      <button type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"></button>
    </div>
    <div id="search-modal-body" class="modal-body">
      {% if saved_search.pk %}<p class="text-success">Search alert saved!</p>{% endif %}
      <form id="saved-search-form"
            hx-target="#saved-search-button"
            {% if saved_search.pk %} hx-post="{% url 'search:saved_search_update' saved_search.pk %}" {% else %} hx-post="{% url 'search:saved_search_create' %}" {% endif %}>
        <div class="mb-3">
          <label class="form-label" for="{{ form.q.id_for_label }}">{% trans 'Search term' %}</label>
          <input type="text"
                 class="form-control"
                 id="{{ form.q.id_for_label }}"
                 value="{{ form.q.value }}"
                 name="{{ form.q.name }}"
                 readonly/>
          {% if form.q.errors %}
            <div class="text-danger">
              {% for error in form.q.errors %}<p class="m-1">{{ error }}</p>{% endfor %}
            </div>
          {% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label" for="{{ form.filters.id_for_label }}">{{ form.filters.label }}</label>
          <input type="text"
                 class="form-control"
                 id="{{ form.filters.id_for_label }}"
                 name="{{ form.filters.name }}"
                 value="{{ form.filters.value }}"
                 readonly/>
          {% if form.filters.errors %}
            <div class="text-danger">
              {% for error in form.filters.errors %}<p class="m-1">{{ error }}</p>{% endfor %}
            </div>
          {% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label" for="{{ form.note.id_for_label }}">{{ form.note.label }}</label>
          <textarea class="form-control"
                    id="{{ form.note.id_for_label }}"
                    name="{{ form.note.name }}">{{ form.note.value|default_if_none:'' }}</textarea>
          {% if form.note.errors %}
            <div class="text-danger">
              {% for error in form.note.errors %}<p class="m-1">{{ error }}</p>{% endfor %}
            </div>
          {% endif %}
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      {% if not request.user.is_authenticated %}
        <a href="{% url 'account_login' %}" class="btn btn-primary">Login</a>
      {% else %}
        <button type="submit" form="saved-search-form" class="btn btn-primary">Save changes</button>
      {% endif %}
    </div>
  </div>
</div>
